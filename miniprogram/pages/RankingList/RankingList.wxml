<!--miniprogram/pages/RankingList.wxml-->

<!-- åˆ†ç±»æ ‡ç­¾ -->
<van-tabs swipeable bind:click="onClick" active="{{ currentIndex }}" color="#188be4">
  <van-tab title="æ‰“å¡æ¦œ" />
  <van-tab title="ç˜¦èº«æ¦œï¼ˆæœˆï¼‰" />
  <van-tab title="è¿žç»­æ‰“å¡æ¦œ" />
</van-tabs>

<!-- é€šå‘Šæ  -->
<van-notice-bar wx:if="{{isInCountRank && currentIndex == 0}}"
  left-icon="../../../images/laba.png"
  mode="closeable"
  background="#ecf9ff"
  color="#188be4"
  text="{{'æ‚¨å½“å‰æŽ’åœ¨ç¬¬' + countIndex + 'ä½ï¼Œæ‰“å¡' + currentUsers[countIndex-1].totalCount + 'æ¬¡ï¼ç»§ç»­åŠªåŠ›å§ï¼'}}" 
/>
<van-notice-bar wx:elif="{{isInReduceRank && currentIndex == 1}}"
  left-icon="../../../images/laba.png"
  mode="closeable"
  background="#ecf9ff"
  color="#188be4"
  text="{{'æ‚¨å½“å‰æŽ’åœ¨ç¬¬' + reduceIndex + 'ä½ï¼Œå‡é‡' + currentUsers[reduceIndex-1].recordsList[0].reduce + 'kgï¼ç»§ç»­åŠªåŠ›å§ï¼'}}" 
/>
<van-notice-bar wx:elif="{{isInContinuousRank && currentIndex == 2}}"
  left-icon="../../../images/laba.png"
  mode="closeable"
  background="#ecf9ff"
  color="#188be4"
  text="{{'æ‚¨å½“å‰æŽ’åœ¨ç¬¬' + continuousIndex + 'ä½ï¼Œè¿žç»­æ‰“å¡' + currentUsers[continuousIndex-1].continuousDays + 'å¤©ï¼ç»§ç»­åŠªåŠ›å§ï¼'}}" 
/>
<van-notice-bar wx:else
  left-icon="../../../images/laba.png"
  mode="closeable"
  background="#fff7e6"
  color="#ff9800"
  text="æŠ±æ­‰ï¼Œæ‚¨æœªå…¥æ¦œï¼Œè¯·ç»§ç»­åŠªåŠ›ï¼â•­(â—ï½€âˆ€Â´â—)â•¯"
/>

<!-- åŠ è½½çŠ¶æ€ -->
<view wx:if="{{ loading }}" class="loading-container">
  <van-loading type="spinner" size="24px" color="#188be4">åŠ è½½ä¸­...</van-loading>
</view>

<!-- æŽ’è¡Œæ¦œå†…å®¹ -->
<view wx:else class="rank-container">
  <!-- å‰ä¸‰åç‰¹æ®Šå±•ç¤º -->
  <view wx:if="{{ currentUsers.length > 0 }}" class="top-three">
    <!-- ç¬¬äºŒå -->
    <view wx:if="{{ currentUsers.length > 1 }}" class="rank-item rank-second" data-index="1">
      <view class="rank-medal">
        <text class="medal-icon">ðŸ¥ˆ</text>
      </view>
      <view class="rank-avatar-wrapper">
        <van-image 
          round 
          width="60rpx" 
          height="60rpx" 
          class="rank-avatar" 
          src="{{ currentUsers[1].avatarUrl }}"
        />
      </view>
      <view class="rank-info">
        <view class="rank-name">{{ currentUsers[1].nickName }}</view>
        <view class="rank-value">
          <text wx:if="{{ currentIndex == 0 }}">{{ currentUsers[1].totalCount }}</text>
          <text wx:elif="{{ currentIndex == 1 }}">{{ currentUsers[1].recordsList[0].reduce }}</text>
          <text wx:else>{{ currentUsers[1].continuousDays }}</text>
          <text class="rank-unit">{{ currentIndex == 0 ? 'æ¬¡' : currentIndex == 1 ? 'kg' : 'å¤©' }}</text>
        </view>
      </view>
    </view>

    <!-- ç¬¬ä¸€å -->
    <view wx:if="{{ currentUsers.length > 0 }}" class="rank-item rank-first" data-index="0">
      <view class="rank-medal">
        <text class="medal-icon">ðŸ¥‡</text>
      </view>
      <view class="rank-avatar-wrapper">
        <van-image 
          round 
          width="80rpx" 
          height="80rpx" 
          class="rank-avatar" 
          src="{{ currentUsers[0].avatarUrl }}"
        />
      </view>
      <view class="rank-info">
        <view class="rank-name">{{ currentUsers[0].nickName }}</view>
        <view class="rank-value">
          <text wx:if="{{ currentIndex == 0 }}">{{ currentUsers[0].totalCount }}</text>
          <text wx:elif="{{ currentIndex == 1 }}">{{ currentUsers[0].recordsList[0].reduce }}</text>
          <text wx:else>{{ currentUsers[0].continuousDays }}</text>
          <text class="rank-unit">{{ currentIndex == 0 ? 'æ¬¡' : currentIndex == 1 ? 'kg' : 'å¤©' }}</text>
        </view>
      </view>
    </view>

    <!-- ç¬¬ä¸‰å -->
    <view wx:if="{{ currentUsers.length > 2 }}" class="rank-item rank-third" data-index="2">
      <view class="rank-medal">
        <text class="medal-icon">ðŸ¥‰</text>
      </view>
      <view class="rank-avatar-wrapper">
        <van-image 
          round 
          width="60rpx" 
          height="60rpx" 
          class="rank-avatar" 
          src="{{ currentUsers[2].avatarUrl }}"
        />
      </view>
      <view class="rank-info">
        <view class="rank-name">{{ currentUsers[2].nickName }}</view>
        <view class="rank-value">
          <text wx:if="{{ currentIndex == 0 }}">{{ currentUsers[2].totalCount }}</text>
          <text wx:elif="{{ currentIndex == 1 }}">{{ currentUsers[2].recordsList[0].reduce }}</text>
          <text wx:else>{{ currentUsers[2].continuousDays }}</text>
          <text class="rank-unit">{{ currentIndex == 0 ? 'æ¬¡' : currentIndex == 1 ? 'kg' : 'å¤©' }}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å…¶ä»–æŽ’ååˆ—è¡¨ -->
  <view class="rank-list">
    <view 
      wx:key="_id" 
      wx:for="{{ currentUsers }}" 
      wx:for-index="idx"
      class="rank-item rank-normal {{ idx < 3 ? 'hidden' : '' }}"
    >
      <view class="rank-number">{{ idx + 1 }}</view>
      <van-image 
        round 
        width="64rpx" 
        height="64rpx" 
        class="rank-avatar-small" 
        src="{{ item.avatarUrl }}"
      />
      <view class="rank-info-normal">
        <view class="rank-name-normal">{{ item.nickName }}</view>
        <view class="rank-value-normal">
          <text wx:if="{{ currentIndex == 0 }}">{{ item.totalCount }}</text>
          <text wx:elif="{{ currentIndex == 1 }}">{{ item.recordsList[0].reduce }}</text>
          <text wx:else>{{ item.continuousDays }}</text>
          <text class="rank-unit-small">{{ currentIndex == 0 ? 'æ¬¡' : currentIndex == 1 ? 'kg' : 'å¤©' }}</text>
        </view>
      </view>
    </view>
  </view>
</view>



